### 大文件下载方案设计

#### 背景

支持交易记录导出 excel 功能，当筛选的交易数据量过大，进行下载时，等待时间过长，影响用户体验，有时还会超出服务器响应时间导致无法下载。

#### 需求分析

- 下载功能支持大文件下载, 超过 100M 以上的文件, 采用分片下载方式
- 下载功能采用流式响应方式避免占用过多内存
- 下载功能支持断点续传
- 下载功能支持进度条显示

#### 后续规划

- 下载功能支持文件名重命名

#### 方案设计

- 分片下载使用 Http Range 请求头，通过设置 Range 请求头，指定文件下载的起始位置和结束位置，从而实现分片下载。
- 采用流式响应方式，避免占用过多内存。
- 断点续传，通过记录文件下载的进度，在下次下载时，根据记录的进度，跳过已经下载的部分，从而实现断点续传。
- 进度条显示，通过计算文件下载的进度，显示进度条，提升用户体验。
- 文件名重命名，支持用户自定义文件名，方便用户保存文件。

#### 总结

大文件下载方案设计，主要是为了解决大文件下载过程中，用户等待时间过长，影响用户体验的问题。通过采用流式响应方式，支持断点续传，可以大幅度提升下载效率。同时，通过文件名重命名，可以支持用户自定义文件名，方便用户保存文件。

#### 项目

安装依赖：

```
npm install
```

启动项目：

```
npm run start:s
```

```
npm run start:c
```

项目目录结构：

```
├── client
│   ├── index.js
├── server
│   ├── app.js
├── public
│   ├── index.html
│   ├── static
├── xlsx
│   ├── chengdu_weather.xlsx
├── package.json
├── package-lock.json
├── README.md
```

- client 目录：前端
- server 目录：后端
- public 目录：静态资源目录
- xlsx 目录：测试文件目录
- README.md：项目说明文档
